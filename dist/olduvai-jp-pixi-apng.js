/*!
 * @olduvai-jp/pixi-apng - v0.1.1
 * Compiled Thu, 26 Jun 2025 15:01:22 UTC
 *
 * @olduvai-jp/pixi-apng is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * 
 * Copyright 2025, dyamagishi <dyamagishi@olduvai.jp>, All Rights Reserved
 */this.PIXI=this.PIXI||{},this.PIXI.pixiApng=function(G,T){"use strict";var $=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function W(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function re(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ne(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")&&Object.keys(e).length===1?e.default:e}function ie(e){if(e.__esModule)return e;var d=e.default;if(typeof d=="function"){var h=function i(){if(this instanceof i){var a=[null];a.push.apply(a,arguments);var c=Function.bind.apply(d,a);return new c}return d.apply(this,arguments)};h.prototype=d.prototype}else h={};return Object.defineProperty(h,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var a=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(h,i,a.get?a:{enumerable:!0,get:function(){return e[i]}})}),h}var M={},Y={get exports(){return M},set exports(e){M=e}};(function(e,d){(function(i,a){e.exports=a()})($,function(){return function(h){var i={};function a(c){if(i[c])return i[c].exports;var m=i[c]={exports:{},id:c,loaded:!1};return h[c].call(m.exports,m,m.exports,a),m.loaded=!0,m.exports}return a.m=h,a.c=i,a.p="",a(0)}([function(h,i,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isNotPNG=o,i.isNotAPNG=l,i.default=r;var c=a(1),m=k(c),y=a(2);function k(p){return p&&p.__esModule?p:{default:p}}var t=new Error("Not a PNG"),s=new Error("Not an animated PNG");function o(p){return p===t}function l(p){return p===s}var u=new Uint8Array([137,80,78,71,13,10,26,10]);function r(p){var _=new Uint8Array(p);if(Array.prototype.some.call(u,function(N,O){return N!==_[O]}))return t;var F=!1;if(f(_,function(N){return!(F=N==="acTL")}),!F)return s;var P=[],x=[],I=null,g=null,V=0,E=new y.APNG;if(f(_,function(N,O,b,C){var A=new DataView(O.buffer);switch(N){case"IHDR":I=O.subarray(b+8,b+8+C),E.width=A.getUint32(b+8),E.height=A.getUint32(b+12);break;case"acTL":E.numPlays=A.getUint32(b+8+4);break;case"fcTL":g&&(E.frames.push(g),V++),g=new y.Frame,g.width=A.getUint32(b+8+4),g.height=A.getUint32(b+8+8),g.left=A.getUint32(b+8+12),g.top=A.getUint32(b+8+16);var te=A.getUint16(b+8+20),S=A.getUint16(b+8+22);S===0&&(S=100),g.delay=1e3*te/S,g.delay<=10&&(g.delay=100),E.playTime+=g.delay,g.disposeOp=A.getUint8(b+8+24),g.blendOp=A.getUint8(b+8+25),g.dataParts=[],V===0&&g.disposeOp===2&&(g.disposeOp=1);break;case"fdAT":g&&g.dataParts.push(O.subarray(b+8+4,b+8+C));break;case"IDAT":g&&g.dataParts.push(O.subarray(b+8,b+8+C));break;case"IEND":x.push(w(O,b,12+C));break;default:P.push(w(O,b,12+C))}}),g&&E.frames.push(g),E.frames.length==0)return s;var Z=new Blob(P),ee=new Blob(x);return E.frames.forEach(function(N){var O=[];O.push(u),I.set(L(N.width),0),I.set(L(N.height),4),O.push(U("IHDR",I)),O.push(Z),N.dataParts.forEach(function(b){return O.push(U("IDAT",b))}),O.push(ee),N.imageData=new Blob(O,{type:"image/png"}),delete N.dataParts,O=null}),E}function f(p,_){var F=new DataView(p.buffer),P=8,x=void 0,I=void 0,g=void 0;do I=F.getUint32(P),x=n(p,P+4,4),g=_(x,p,P,I),P+=12+I;while(g!==!1&&x!="IEND"&&P<p.length)}function n(p,_,F){var P=Array.prototype.slice.call(p.subarray(_,_+F));return String.fromCharCode.apply(String,P)}function v(p){for(var _=new Uint8Array(p.length),F=0;F<p.length;F++)_[F]=p.charCodeAt(F);return _}function w(p,_,F){var P=new Uint8Array(F);return P.set(p.subarray(_,_+F)),P}var U=function(_,F){var P=_.length+F.length,x=new Uint8Array(P+8),I=new DataView(x.buffer);I.setUint32(0,F.length),x.set(v(_),4),x.set(F,8);var g=(0,m.default)(x,4,P);return I.setUint32(P+4,g),x},L=function(_){return new Uint8Array([_>>>24&255,_>>>16&255,_>>>8&255,_&255])}},function(h,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(k){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:k.length-t,o=-1,l=t,u=t+s;l<u;l++)o=o>>>8^a[(o^k[l])&255];return o^-1};for(var a=new Uint32Array(256),c=0;c<256;c++){for(var m=c,y=0;y<8;y++)m=m&1?3988292384^m>>>1:m>>>1;a[c]=m}},function(h,i,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Frame=i.APNG=void 0;var c=function(){function l(u,r){for(var f=0;f<r.length;f++){var n=r[f];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(u,n.key,n)}}return function(u,r,f){return r&&l(u.prototype,r),f&&l(u,f),u}}(),m=a(3),y=k(m);function k(l){return l&&l.__esModule?l:{default:l}}function t(l,u){if(!(l instanceof u))throw new TypeError("Cannot call a class as a function")}var s=i.APNG=function(){function l(){t(this,l),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[]}return c(l,[{key:"createImages",value:function(){return Promise.all(this.frames.map(function(r){return r.createImage()}))}},{key:"getPlayer",value:function(r){var f=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return this.createImages().then(function(){return new y.default(f,r,n)})}}]),l}(),o=i.Frame=function(){function l(){t(this,l),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.imageData=null,this.imageElement=null}return c(l,[{key:"createImage",value:function(){var r=this;return this.imageElement?Promise.resolve():new Promise(function(f,n){var v=URL.createObjectURL(r.imageData);r.imageElement=document.createElement("img"),r.imageElement.onload=function(){URL.revokeObjectURL(v),f()},r.imageElement.onerror=function(){URL.revokeObjectURL(v),r.imageElement=null,n(new Error("Image creation error"))},r.imageElement.src=v})}}]),l}()},function(h,i,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var c=function(){function u(r,f){for(var n=0;n<f.length;n++){var v=f[n];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(r,v.key,v)}}return function(r,f,n){return f&&u(r.prototype,f),n&&u(r,n),r}}(),m=a(4),y=k(m);function k(u){return u&&u.__esModule?u:{default:u}}function t(u,r){if(!(u instanceof r))throw new TypeError("Cannot call a class as a function")}function s(u,r){if(!u)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:u}function o(u,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);u.prototype=Object.create(r&&r.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(u,r):u.__proto__=r)}var l=function(u){o(r,u);function r(f,n,v){t(this,r);var w=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return w.playbackRate=1,w._currentFrameNumber=0,w._ended=!1,w._paused=!0,w._numPlays=0,w._rafId=null,w._apng=f,w.context=n,w.stop(),v&&w.play(),w}return c(r,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,this._apng.numPlays!==0&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this._prevFrame&&this._prevFrame.disposeOp==1?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&this._prevFrame.disposeOp==2&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var n=this.currentFrame;this._prevFrame=n,this._prevFrameData=null,n.disposeOp==2&&(this._prevFrameData=this.context.getImageData(n.left,n.top,n.width,n.height)),n.blendOp==0&&this.context.clearRect(n.left,n.top,n.width,n.height),this.context.drawImage(n.imageElement,n.left,n.top),this.emit("frame",this._currentFrameNumber),this._ended&&this.emit("end")}},{key:"play",value:function(){var n=this;this._rafId&&cancelAnimationFrame(this._rafId),this.emit("play"),this._ended&&this.stop(),this._paused=!1;var v=performance.now()+this.currentFrame.delay/this.playbackRate,w=function U(L){if(!(n._ended||n._paused)){if(L>=v){for(;L-v>=n._apng.playTime/n.playbackRate;)v+=n._apng.playTime/n.playbackRate,n._numPlays++;do n.renderNextFrame(),v+=n.currentFrame.delay/n.playbackRate;while(!n._ended&&!n._paused&&L>v)}n._rafId=requestAnimationFrame(U)}};this._rafId=requestAnimationFrame(w)}},{key:"pause",value:function(){this._paused||(this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null),this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null),this.emit("stop"),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]),r}(y.default);i.default=l},function(h,i){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}h.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(t){if(!m(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},a.prototype.emit=function(t){var s,o,l,u,r,f;if(this._events||(this._events={}),t==="error"&&(!this._events.error||y(this._events.error)&&!this._events.error.length)){if(s=arguments[1],s instanceof Error)throw s;var n=new Error('Uncaught, unspecified "error" event. ('+s+")");throw n.context=s,n}if(o=this._events[t],k(o))return!1;if(c(o))switch(arguments.length){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),o.apply(this,u)}else if(y(o))for(u=Array.prototype.slice.call(arguments,1),f=o.slice(),l=f.length,r=0;r<l;r++)f[r].apply(this,u);return!0},a.prototype.addListener=function(t,s){var o;if(!c(s))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,c(s.listener)?s.listener:s),this._events[t]?y(this._events[t])?this._events[t].push(s):this._events[t]=[this._events[t],s]:this._events[t]=s,y(this._events[t])&&!this._events[t].warned&&(k(this._maxListeners)?o=a.defaultMaxListeners:o=this._maxListeners,o&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),typeof console.trace=="function"&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(t,s){if(!c(s))throw TypeError("listener must be a function");var o=!1;function l(){this.removeListener(t,l),o||(o=!0,s.apply(this,arguments))}return l.listener=s,this.on(t,l),this},a.prototype.removeListener=function(t,s){var o,l,u,r;if(!c(s))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=this._events[t],u=o.length,l=-1,o===s||c(o.listener)&&o.listener===s)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,s);else if(y(o)){for(r=u;r-- >0;)if(o[r]===s||o[r].listener&&o[r].listener===s){l=r;break}if(l<0)return this;o.length===1?(o.length=0,delete this._events[t]):o.splice(l,1),this._events.removeListener&&this.emit("removeListener",t,s)}return this},a.prototype.removeAllListeners=function(t){var s,o;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[t]&&delete this._events[t],this;if(arguments.length===0){for(s in this._events)s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events={},this}if(o=this._events[t],c(o))this.removeListener(t,o);else if(o)for(;o.length;)this.removeListener(t,o[o.length-1]);return delete this._events[t],this},a.prototype.listeners=function(t){var s;return!this._events||!this._events[t]?s=[]:c(this._events[t])?s=[this._events[t]]:s=this._events[t].slice(),s},a.prototype.listenerCount=function(t){if(this._events){var s=this._events[t];if(c(s))return 1;if(s)return s.length}return 0},a.listenerCount=function(t,s){return t.listenerCount(s)};function c(t){return typeof t=="function"}function m(t){return typeof t=="number"}function y(t){return typeof t=="object"&&t!==null}function k(t){return t===void 0}}])})})(Y,M);var z=W(M),J=Object.defineProperty,R=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,H=(e,d,h)=>d in e?J(e,d,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[d]=h,K=(e,d)=>{for(var h in d||(d={}))B.call(d,h)&&H(e,h,d[h]);if(R)for(var h of R(d))q.call(d,h)&&H(e,h,d[h]);return e},Q=(e,d)=>{var h={};for(var i in e)B.call(e,i)&&d.indexOf(i)<0&&(h[i]=e[i]);if(e!=null&&R)for(var i of R(e))d.indexOf(i)<0&&q.call(e,i)&&(h[i]=e[i]);return h};const D=class extends T.Sprite{constructor(e,d){super(T.Texture.EMPTY),this.animationSpeed=1,this.loop=!0,this.duration=0,this.autoPlay=!0,this.dirty=!1,this._currentFrame=0,this._autoUpdate=!1,this._isConnectedToTicker=!1,this._playing=!1,this._currentTime=0,this.onRender=()=>this.updateFrame();const h=Object.assign({},D.defaultOptions,d),{scaleMode:i,width:a,height:c}=h,m=Q(h,["scaleMode","width","height"]),y=T.DOMAdapter.get().createCanvas(a,c),k=y.getContext("2d");this.texture=T.Texture.from(y),this.texture.source.scaleMode=i,this.duration=e[e.length-1].end,this._frames=e,this._context=k,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,m),this.currentFrame=0,m.autoPlay&&this.play()}static async fromBuffer(e,d){if(!e||e.byteLength===0)throw new Error("Invalid buffer");const h=z(e);if(h instanceof Error)throw new Error(`Failed to parse APNG: ${h.message}`);const i=h;await i.createImages();const a=[],c=T.DOMAdapter.get().createCanvas(i.width,i.height),m=c.getContext("2d",{willReadFrequently:!0});let y=0;const{fps:k}=Object.assign({},D.defaultOptions,d),t=1e3/k;let s=null;for(let u=0;u<i.frames.length;u++){const r=i.frames[u],{delay:f,width:n,height:v,left:w,top:U,blendOp:L,disposeOp:p}=r;p===2&&s?m.putImageData(s,0,0):p===1&&m.clearRect(w,U,n,v),s=m.getImageData(0,0,i.width,i.height),m.globalCompositeOperation=L===0?"copy":"source-over",r.imageElement&&m.drawImage(r.imageElement,w,U);const _=f&&f>0?f:t;a.push({start:y,end:y+_,imageData:m.getImageData(0,0,i.width,i.height)}),y+=_}c.width=c.height=0;const{width:o,height:l}=i;return new D(a,K({width:o,height:l},d))}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(T.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(T.Ticker.shared.add(this.update,this,T.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0),!this.loop&&this.currentFrame===this._frames.length-1&&(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(){var e,d;if(!this._playing)return;const h=this.animationSpeed*T.Ticker.shared.deltaMS,i=this._currentTime+h,a=i%this.duration,c=this._frames.findIndex(m=>m.start<=a&&m.end>a);i>=this.duration?this.loop?(this._currentTime=a,this.updateFrameIndex(c),(e=this.onLoop)==null||e.call(this)):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),(d=this.onComplete)==null||d.call(this),this.stop()):(this._currentTime=a,this.updateFrameIndex(c))}updateFrame(){if(!this.dirty)return;const{imageData:e}=this._frames[this._currentFrame];this._context.putImageData(e,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.source.update(),this.dirty=!1}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(T.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(T.Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(e){this.updateFrameIndex(e),this._currentTime=this._frames[e].start}updateFrameIndex(e){var d;if(e<0||e>=this._frames.length)throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${e}`);this._currentFrame!==e&&(this._currentFrame=e,this.dirty=!0,(d=this.onFrameChange)==null||d.call(this,e))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const e=null;this._context=e,this._frames=e,this.onComplete=e,this.onFrameChange=e,this.onLoop=e}clone(){const e=new D([...this._frames],{autoUpdate:this._autoUpdate,loop:this.loop,autoPlay:this.autoPlay,scaleMode:this.texture.source.scaleMode,animationSpeed:this.animationSpeed,width:this._context.canvas.width,height:this._context.canvas.height,onComplete:this.onComplete,onFrameChange:this.onFrameChange,onLoop:this.onLoop});return e.dirty=!0,e}};let j=D;j.defaultOptions={scaleMode:"linear",fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null};const X={extension:T.ExtensionType.Asset,detection:{test:async()=>!0,add:async e=>[...e,"apng"],remove:async e=>e.filter(d=>d!=="apng")},loader:{name:"apngLoader",test:e=>T.path.extname(e)===".apng",load:async(e,d)=>{const h=await(await T.DOMAdapter.get().fetch(e)).arrayBuffer();return j.fromBuffer(h,d==null?void 0:d.data)},unload:async e=>{e.destroy()}}};return T.extensions.add(X),G.APNGAsset=X,G.AnimatedAPNG=j,G}({},PIXI);
//# sourceMappingURL=olduvai-jp-pixi-apng.js.map
