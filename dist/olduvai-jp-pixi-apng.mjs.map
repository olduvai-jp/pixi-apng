{"version":3,"file":"olduvai-jp-pixi-apng.mjs","sources":["../node_modules/apng-js/lib/index.js","../src/AnimatedAPNG.ts","../src/APNGAsset.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"apng-js\"] = factory();\n\telse\n\t\troot[\"apng-js\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.isNotPNG = isNotPNG;\n\texports.isNotAPNG = isNotAPNG;\n\texports.default = parseAPNG;\n\n\tvar _crc = __webpack_require__(1);\n\n\tvar _crc2 = _interopRequireDefault(_crc);\n\n\tvar _structs = __webpack_require__(2);\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\tvar errNotPNG = new Error('Not a PNG');\n\tvar errNotAPNG = new Error('Not an animated PNG');\n\n\tfunction isNotPNG(err) {\n\t    return err === errNotPNG;\n\t}\n\tfunction isNotAPNG(err) {\n\t    return err === errNotAPNG;\n\t}\n\n\t// '\\x89PNG\\x0d\\x0a\\x1a\\x0a'\n\tvar PNGSignature = new Uint8Array([0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a]);\n\n\t/**\r\n\t * Parse APNG data\r\n\t * @param {ArrayBuffer} buffer\r\n\t * @return {APNG|Error}\r\n\t */\n\tfunction parseAPNG(buffer) {\n\t    var bytes = new Uint8Array(buffer);\n\n\t    if (Array.prototype.some.call(PNGSignature, function (b, i) {\n\t        return b !== bytes[i];\n\t    })) {\n\t        return errNotPNG;\n\t    }\n\n\t    // fast animation test\n\t    var isAnimated = false;\n\t    eachChunk(bytes, function (type) {\n\t        return !(isAnimated = type === 'acTL');\n\t    });\n\t    if (!isAnimated) {\n\t        return errNotAPNG;\n\t    }\n\n\t    var preDataParts = [],\n\t        postDataParts = [];\n\t    var headerDataBytes = null,\n\t        frame = null,\n\t        frameNumber = 0,\n\t        apng = new _structs.APNG();\n\n\t    eachChunk(bytes, function (type, bytes, off, length) {\n\t        var dv = new DataView(bytes.buffer);\n\t        switch (type) {\n\t            case 'IHDR':\n\t                headerDataBytes = bytes.subarray(off + 8, off + 8 + length);\n\t                apng.width = dv.getUint32(off + 8);\n\t                apng.height = dv.getUint32(off + 12);\n\t                break;\n\t            case 'acTL':\n\t                apng.numPlays = dv.getUint32(off + 8 + 4);\n\t                break;\n\t            case 'fcTL':\n\t                if (frame) {\n\t                    apng.frames.push(frame);\n\t                    frameNumber++;\n\t                }\n\t                frame = new _structs.Frame();\n\t                frame.width = dv.getUint32(off + 8 + 4);\n\t                frame.height = dv.getUint32(off + 8 + 8);\n\t                frame.left = dv.getUint32(off + 8 + 12);\n\t                frame.top = dv.getUint32(off + 8 + 16);\n\t                var delayN = dv.getUint16(off + 8 + 20);\n\t                var delayD = dv.getUint16(off + 8 + 22);\n\t                if (delayD === 0) {\n\t                    delayD = 100;\n\t                }\n\t                frame.delay = 1000 * delayN / delayD;\n\t                // https://bugzilla.mozilla.org/show_bug.cgi?id=125137\n\t                // https://bugzilla.mozilla.org/show_bug.cgi?id=139677\n\t                // https://bugzilla.mozilla.org/show_bug.cgi?id=207059\n\t                if (frame.delay <= 10) {\n\t                    frame.delay = 100;\n\t                }\n\t                apng.playTime += frame.delay;\n\t                frame.disposeOp = dv.getUint8(off + 8 + 24);\n\t                frame.blendOp = dv.getUint8(off + 8 + 25);\n\t                frame.dataParts = [];\n\t                if (frameNumber === 0 && frame.disposeOp === 2) {\n\t                    frame.disposeOp = 1;\n\t                }\n\t                break;\n\t            case 'fdAT':\n\t                if (frame) {\n\t                    frame.dataParts.push(bytes.subarray(off + 8 + 4, off + 8 + length));\n\t                }\n\t                break;\n\t            case 'IDAT':\n\t                if (frame) {\n\t                    frame.dataParts.push(bytes.subarray(off + 8, off + 8 + length));\n\t                }\n\t                break;\n\t            case 'IEND':\n\t                postDataParts.push(subBuffer(bytes, off, 12 + length));\n\t                break;\n\t            default:\n\t                preDataParts.push(subBuffer(bytes, off, 12 + length));\n\t        }\n\t    });\n\n\t    if (frame) {\n\t        apng.frames.push(frame);\n\t    }\n\n\t    if (apng.frames.length == 0) {\n\t        return errNotAPNG;\n\t    }\n\n\t    var preBlob = new Blob(preDataParts),\n\t        postBlob = new Blob(postDataParts);\n\n\t    apng.frames.forEach(function (frame) {\n\t        var bb = [];\n\t        bb.push(PNGSignature);\n\t        headerDataBytes.set(makeDWordArray(frame.width), 0);\n\t        headerDataBytes.set(makeDWordArray(frame.height), 4);\n\t        bb.push(makeChunkBytes('IHDR', headerDataBytes));\n\t        bb.push(preBlob);\n\t        frame.dataParts.forEach(function (p) {\n\t            return bb.push(makeChunkBytes('IDAT', p));\n\t        });\n\t        bb.push(postBlob);\n\t        frame.imageData = new Blob(bb, { 'type': 'image/png' });\n\t        delete frame.dataParts;\n\t        bb = null;\n\t    });\n\n\t    return apng;\n\t}\n\n\t/**\r\n\t * @param {Uint8Array} bytes\r\n\t * @param {function(string, Uint8Array, int, int): boolean} callback\r\n\t */\n\tfunction eachChunk(bytes, callback) {\n\t    var dv = new DataView(bytes.buffer);\n\t    var off = 8,\n\t        type = void 0,\n\t        length = void 0,\n\t        res = void 0;\n\t    do {\n\t        length = dv.getUint32(off);\n\t        type = readString(bytes, off + 4, 4);\n\t        res = callback(type, bytes, off, length);\n\t        off += 12 + length;\n\t    } while (res !== false && type != 'IEND' && off < bytes.length);\n\t}\n\n\t/**\r\n\t *\r\n\t * @param {Uint8Array} bytes\r\n\t * @param {number} off\r\n\t * @param {number} length\r\n\t * @return {string}\r\n\t */\n\tfunction readString(bytes, off, length) {\n\t    var chars = Array.prototype.slice.call(bytes.subarray(off, off + length));\n\t    return String.fromCharCode.apply(String, chars);\n\t}\n\n\t/**\r\n\t *\r\n\t * @param {string} x\r\n\t * @return {Uint8Array}\r\n\t */\n\tfunction makeStringArray(x) {\n\t    var res = new Uint8Array(x.length);\n\t    for (var i = 0; i < x.length; i++) {\n\t        res[i] = x.charCodeAt(i);\n\t    }\n\t    return res;\n\t}\n\n\t/**\r\n\t * @param {Uint8Array} bytes\r\n\t * @param {int} start\r\n\t * @param {int} length\r\n\t * @return {Uint8Array}\r\n\t */\n\tfunction subBuffer(bytes, start, length) {\n\t    var a = new Uint8Array(length);\n\t    a.set(bytes.subarray(start, start + length));\n\t    return a;\n\t}\n\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Uint8Array} dataBytes\r\n\t * @return {Uint8Array}\r\n\t */\n\tvar makeChunkBytes = function makeChunkBytes(type, dataBytes) {\n\t    var crcLen = type.length + dataBytes.length;\n\t    var bytes = new Uint8Array(crcLen + 8);\n\t    var dv = new DataView(bytes.buffer);\n\n\t    dv.setUint32(0, dataBytes.length);\n\t    bytes.set(makeStringArray(type), 4);\n\t    bytes.set(dataBytes, 8);\n\t    var crc = (0, _crc2.default)(bytes, 4, crcLen);\n\t    dv.setUint32(crcLen + 4, crc);\n\t    return bytes;\n\t};\n\n\tvar makeDWordArray = function makeDWordArray(x) {\n\t    return new Uint8Array([x >>> 24 & 0xff, x >>> 16 & 0xff, x >>> 8 & 0xff, x & 0xff]);\n\t};\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\n\t\"use strict\";\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\n\texports.default = function (bytes) {\n\t  var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\t  var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : bytes.length - start;\n\n\t  var crc = -1;\n\t  for (var _i = start, l = start + length; _i < l; _i++) {\n\t    crc = crc >>> 8 ^ table[(crc ^ bytes[_i]) & 0xFF];\n\t  }\n\t  return crc ^ -1;\n\t};\n\n\tvar table = new Uint32Array(256);\n\n\tfor (var i = 0; i < 256; i++) {\n\t  var c = i;\n\t  for (var k = 0; k < 8; k++) {\n\t    c = (c & 1) !== 0 ? 0xEDB88320 ^ c >>> 1 : c >>> 1;\n\t  }\n\t  table[i] = c;\n\t}\n\n\t/**\r\n\t *\r\n\t * @param {Uint8Array} bytes\r\n\t * @param {number} start\r\n\t * @param {number} length\r\n\t * @return {number}\r\n\t */\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.Frame = exports.APNG = undefined;\n\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\n\tvar _player = __webpack_require__(3);\n\n\tvar _player2 = _interopRequireDefault(_player);\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\t/**\r\n\t * @property {number} currFrameNumber\r\n\t * @property {Frame} currFrame\r\n\t * @property {boolean} paused\r\n\t * @property {boolean} ended\r\n\t */\n\tvar APNG = exports.APNG = function () {\n\t    function APNG() {\n\t        _classCallCheck(this, APNG);\n\n\t        this.width = 0;\n\t        this.height = 0;\n\t        this.numPlays = 0;\n\t        this.playTime = 0;\n\t        this.frames = [];\n\t    }\n\t    /** @type {number} */\n\n\t    /** @type {number} */\n\n\t    /** @type {number} */\n\n\t    /** @type {number} */\n\n\t    /** @type {Frame[]} */\n\n\n\t    _createClass(APNG, [{\n\t        key: 'createImages',\n\n\n\t        /**\r\n\t         *\r\n\t         * @return {Promise.<*>}\r\n\t         */\n\t        value: function createImages() {\n\t            return Promise.all(this.frames.map(function (f) {\n\t                return f.createImage();\n\t            }));\n\t        }\n\n\t        /**\r\n\t         *\r\n\t         * @param {CanvasRenderingContext2D} context\r\n\t         * @param {boolean} autoPlay\r\n\t         * @return {Promise.<Player>}\r\n\t         */\n\n\t    }, {\n\t        key: 'getPlayer',\n\t        value: function getPlayer(context) {\n\t            var _this = this;\n\n\t            var autoPlay = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t            return this.createImages().then(function () {\n\t                return new _player2.default(_this, context, autoPlay);\n\t            });\n\t        }\n\t    }]);\n\n\t    return APNG;\n\t}();\n\n\tvar Frame = exports.Frame = function () {\n\t    function Frame() {\n\t        _classCallCheck(this, Frame);\n\n\t        this.left = 0;\n\t        this.top = 0;\n\t        this.width = 0;\n\t        this.height = 0;\n\t        this.delay = 0;\n\t        this.disposeOp = 0;\n\t        this.blendOp = 0;\n\t        this.imageData = null;\n\t        this.imageElement = null;\n\t    }\n\t    /** @type {number} */\n\n\t    /** @type {number} */\n\n\t    /** @type {number} */\n\n\t    /** @type {number} */\n\n\t    /** @type {number} */\n\n\t    /** @type {number} */\n\n\t    /** @type {number} */\n\n\t    /** @type {Blob} */\n\n\t    /** @type {HTMLImageElement} */\n\n\n\t    _createClass(Frame, [{\n\t        key: 'createImage',\n\t        value: function createImage() {\n\t            var _this2 = this;\n\n\t            if (this.imageElement) {\n\t                return Promise.resolve();\n\t            }\n\t            return new Promise(function (resolve, reject) {\n\t                var url = URL.createObjectURL(_this2.imageData);\n\t                _this2.imageElement = document.createElement('img');\n\t                _this2.imageElement.onload = function () {\n\t                    URL.revokeObjectURL(url);\n\t                    resolve();\n\t                };\n\t                _this2.imageElement.onerror = function () {\n\t                    URL.revokeObjectURL(url);\n\t                    _this2.imageElement = null;\n\t                    reject(new Error(\"Image creation error\"));\n\t                };\n\t                _this2.imageElement.src = url;\n\t            });\n\t        }\n\t    }]);\n\n\t    return Frame;\n\t}();\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\n\tvar _events = __webpack_require__(4);\n\n\tvar _events2 = _interopRequireDefault(_events);\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\tvar _class = function (_EventEmitter) {\n\t    _inherits(_class, _EventEmitter);\n\n\t    /**\r\n\t     * @param {APNG} apng\r\n\t     * @param {CanvasRenderingContext2D} context\r\n\t     * @param {boolean} autoPlay\r\n\t     */\n\n\t    /** @type {number} */\n\n\n\t    /** @type {boolean} */\n\n\t    /** @type {ImageData} */\n\n\n\t    /** @type {APNG} */\n\n\t    /** @type {CanvasRenderingContext2D} */\n\t    function _class(apng, context, autoPlay) {\n\t        _classCallCheck(this, _class);\n\n\t        var _this = _possibleConstructorReturn(this, (_class.__proto__ || Object.getPrototypeOf(_class)).call(this));\n\n\t        _this.playbackRate = 1.0;\n\t        _this._currentFrameNumber = 0;\n\t        _this._ended = false;\n\t        _this._paused = true;\n\t        _this._numPlays = 0;\n\t        _this._rafId = null;\n\n\t        _this._apng = apng;\n\t        _this.context = context;\n\t        _this.stop();\n\t        if (autoPlay) {\n\t            _this.play();\n\t        }\n\t        return _this;\n\t    }\n\n\t    /**\r\n\t     *\r\n\t     * @return {number}\r\n\t     */\n\n\t    /** @type {number|null} */\n\n\t    /** @type {boolean} */\n\n\t    /** @type {number} */\n\n\t    /** @type {Frame} */\n\n\t    /** @type {number} */\n\n\n\t    _createClass(_class, [{\n\t        key: 'renderNextFrame',\n\t        value: function renderNextFrame() {\n\t            this._currentFrameNumber = (this._currentFrameNumber + 1) % this._apng.frames.length;\n\t            if (this._currentFrameNumber === this._apng.frames.length - 1) {\n\t                this._numPlays++;\n\t                if (this._apng.numPlays !== 0 && this._numPlays >= this._apng.numPlays) {\n\t                    this._ended = true;\n\t                    this._paused = true;\n\t                }\n\t            }\n\n\t            if (this._prevFrame && this._prevFrame.disposeOp == 1) {\n\t                this.context.clearRect(this._prevFrame.left, this._prevFrame.top, this._prevFrame.width, this._prevFrame.height);\n\t            } else if (this._prevFrame && this._prevFrame.disposeOp == 2) {\n\t                this.context.putImageData(this._prevFrameData, this._prevFrame.left, this._prevFrame.top);\n\t            }\n\n\t            var frame = this.currentFrame;\n\t            this._prevFrame = frame;\n\t            this._prevFrameData = null;\n\t            if (frame.disposeOp == 2) {\n\t                this._prevFrameData = this.context.getImageData(frame.left, frame.top, frame.width, frame.height);\n\t            }\n\t            if (frame.blendOp == 0) {\n\t                this.context.clearRect(frame.left, frame.top, frame.width, frame.height);\n\t            }\n\n\t            this.context.drawImage(frame.imageElement, frame.left, frame.top);\n\n\t            this.emit('frame', this._currentFrameNumber);\n\t            if (this._ended) {\n\t                this.emit('end');\n\t            }\n\t        }\n\n\t        // playback\n\n\t    }, {\n\t        key: 'play',\n\t        value: function play() {\n\t            var _this2 = this;\n\n\t            if (this._rafId) {\n\t                cancelAnimationFrame(this._rafId);\n\t            }\n\n\t            this.emit('play');\n\n\t            if (this._ended) {\n\t                this.stop();\n\t            }\n\t            this._paused = false;\n\n\t            var nextRenderTime = performance.now() + this.currentFrame.delay / this.playbackRate;\n\t            var tick = function tick(now) {\n\t                if (_this2._ended || _this2._paused) {\n\t                    return;\n\t                }\n\t                if (now >= nextRenderTime) {\n\t                    while (now - nextRenderTime >= _this2._apng.playTime / _this2.playbackRate) {\n\t                        nextRenderTime += _this2._apng.playTime / _this2.playbackRate;\n\t                        _this2._numPlays++;\n\t                    }\n\t                    do {\n\t                        _this2.renderNextFrame();\n\t                        nextRenderTime += _this2.currentFrame.delay / _this2.playbackRate;\n\t                    } while (!_this2._ended && !_this2._paused && now > nextRenderTime);\n\t                }\n\t                _this2._rafId = requestAnimationFrame(tick);\n\t            };\n\t            this._rafId = requestAnimationFrame(tick);\n\t        }\n\t    }, {\n\t        key: 'pause',\n\t        value: function pause() {\n\t            if (!this._paused) {\n\t                if (this._rafId) {\n\t                    cancelAnimationFrame(this._rafId);\n\t                    this._rafId = null;\n\t                }\n\t                this.emit('pause');\n\t                this._paused = true;\n\t            }\n\t        }\n\t    }, {\n\t        key: 'stop',\n\t        value: function stop() {\n\t            if (this._rafId) {\n\t                cancelAnimationFrame(this._rafId);\n\t                this._rafId = null;\n\t            }\n\t            this.emit('stop');\n\t            this._numPlays = 0;\n\t            this._ended = false;\n\t            this._paused = true;\n\t            // render first frame\n\t            this._currentFrameNumber = -1;\n\t            this.context.clearRect(0, 0, this._apng.width, this._apng.height);\n\t            this.renderNextFrame();\n\t        }\n\t    }, {\n\t        key: 'currentFrameNumber',\n\t        get: function get() {\n\t            return this._currentFrameNumber;\n\t        }\n\n\t        /**\r\n\t         *\r\n\t         * @return {Frame}\r\n\t         */\n\n\t    }, {\n\t        key: 'currentFrame',\n\t        get: function get() {\n\t            return this._apng.frames[this._currentFrameNumber];\n\t        }\n\t    }, {\n\t        key: 'paused',\n\t        get: function get() {\n\t            return this._paused;\n\t        }\n\t    }, {\n\t        key: 'ended',\n\t        get: function get() {\n\t            return this._ended;\n\t        }\n\t    }]);\n\n\t    return _class;\n\t}(_events2.default);\n\n\texports.default = _class;\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports) {\n\n\t// Copyright Joyent, Inc. and other Node contributors.\n\t//\n\t// Permission is hereby granted, free of charge, to any person obtaining a\n\t// copy of this software and associated documentation files (the\n\t// \"Software\"), to deal in the Software without restriction, including\n\t// without limitation the rights to use, copy, modify, merge, publish,\n\t// distribute, sublicense, and/or sell copies of the Software, and to permit\n\t// persons to whom the Software is furnished to do so, subject to the\n\t// following conditions:\n\t//\n\t// The above copyright notice and this permission notice shall be included\n\t// in all copies or substantial portions of the Software.\n\t//\n\t// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n\t// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n\t// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n\t// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n\t// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n\t// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n\t// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\tfunction EventEmitter() {\n\t  this._events = this._events || {};\n\t  this._maxListeners = this._maxListeners || undefined;\n\t}\n\tmodule.exports = EventEmitter;\n\n\t// Backwards-compat with node 0.10.x\n\tEventEmitter.EventEmitter = EventEmitter;\n\n\tEventEmitter.prototype._events = undefined;\n\tEventEmitter.prototype._maxListeners = undefined;\n\n\t// By default EventEmitters will print a warning if more than 10 listeners are\n\t// added to it. This is a useful default which helps finding memory leaks.\n\tEventEmitter.defaultMaxListeners = 10;\n\n\t// Obviously not all Emitters should be limited to 10. This function allows\n\t// that to be increased. Set to zero for unlimited.\n\tEventEmitter.prototype.setMaxListeners = function(n) {\n\t  if (!isNumber(n) || n < 0 || isNaN(n))\n\t    throw TypeError('n must be a positive number');\n\t  this._maxListeners = n;\n\t  return this;\n\t};\n\n\tEventEmitter.prototype.emit = function(type) {\n\t  var er, handler, len, args, i, listeners;\n\n\t  if (!this._events)\n\t    this._events = {};\n\n\t  // If there is no 'error' event listener then throw.\n\t  if (type === 'error') {\n\t    if (!this._events.error ||\n\t        (isObject(this._events.error) && !this._events.error.length)) {\n\t      er = arguments[1];\n\t      if (er instanceof Error) {\n\t        throw er; // Unhandled 'error' event\n\t      } else {\n\t        // At least give some kind of context to the user\n\t        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n\t        err.context = er;\n\t        throw err;\n\t      }\n\t    }\n\t  }\n\n\t  handler = this._events[type];\n\n\t  if (isUndefined(handler))\n\t    return false;\n\n\t  if (isFunction(handler)) {\n\t    switch (arguments.length) {\n\t      // fast cases\n\t      case 1:\n\t        handler.call(this);\n\t        break;\n\t      case 2:\n\t        handler.call(this, arguments[1]);\n\t        break;\n\t      case 3:\n\t        handler.call(this, arguments[1], arguments[2]);\n\t        break;\n\t      // slower\n\t      default:\n\t        args = Array.prototype.slice.call(arguments, 1);\n\t        handler.apply(this, args);\n\t    }\n\t  } else if (isObject(handler)) {\n\t    args = Array.prototype.slice.call(arguments, 1);\n\t    listeners = handler.slice();\n\t    len = listeners.length;\n\t    for (i = 0; i < len; i++)\n\t      listeners[i].apply(this, args);\n\t  }\n\n\t  return true;\n\t};\n\n\tEventEmitter.prototype.addListener = function(type, listener) {\n\t  var m;\n\n\t  if (!isFunction(listener))\n\t    throw TypeError('listener must be a function');\n\n\t  if (!this._events)\n\t    this._events = {};\n\n\t  // To avoid recursion in the case that type === \"newListener\"! Before\n\t  // adding it to the listeners, first emit \"newListener\".\n\t  if (this._events.newListener)\n\t    this.emit('newListener', type,\n\t              isFunction(listener.listener) ?\n\t              listener.listener : listener);\n\n\t  if (!this._events[type])\n\t    // Optimize the case of one listener. Don't need the extra array object.\n\t    this._events[type] = listener;\n\t  else if (isObject(this._events[type]))\n\t    // If we've already got an array, just append.\n\t    this._events[type].push(listener);\n\t  else\n\t    // Adding the second element, need to change to array.\n\t    this._events[type] = [this._events[type], listener];\n\n\t  // Check for listener leak\n\t  if (isObject(this._events[type]) && !this._events[type].warned) {\n\t    if (!isUndefined(this._maxListeners)) {\n\t      m = this._maxListeners;\n\t    } else {\n\t      m = EventEmitter.defaultMaxListeners;\n\t    }\n\n\t    if (m && m > 0 && this._events[type].length > m) {\n\t      this._events[type].warned = true;\n\t      console.error('(node) warning: possible EventEmitter memory ' +\n\t                    'leak detected. %d listeners added. ' +\n\t                    'Use emitter.setMaxListeners() to increase limit.',\n\t                    this._events[type].length);\n\t      if (typeof console.trace === 'function') {\n\t        // not supported in IE 10\n\t        console.trace();\n\t      }\n\t    }\n\t  }\n\n\t  return this;\n\t};\n\n\tEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\n\tEventEmitter.prototype.once = function(type, listener) {\n\t  if (!isFunction(listener))\n\t    throw TypeError('listener must be a function');\n\n\t  var fired = false;\n\n\t  function g() {\n\t    this.removeListener(type, g);\n\n\t    if (!fired) {\n\t      fired = true;\n\t      listener.apply(this, arguments);\n\t    }\n\t  }\n\n\t  g.listener = listener;\n\t  this.on(type, g);\n\n\t  return this;\n\t};\n\n\t// emits a 'removeListener' event iff the listener was removed\n\tEventEmitter.prototype.removeListener = function(type, listener) {\n\t  var list, position, length, i;\n\n\t  if (!isFunction(listener))\n\t    throw TypeError('listener must be a function');\n\n\t  if (!this._events || !this._events[type])\n\t    return this;\n\n\t  list = this._events[type];\n\t  length = list.length;\n\t  position = -1;\n\n\t  if (list === listener ||\n\t      (isFunction(list.listener) && list.listener === listener)) {\n\t    delete this._events[type];\n\t    if (this._events.removeListener)\n\t      this.emit('removeListener', type, listener);\n\n\t  } else if (isObject(list)) {\n\t    for (i = length; i-- > 0;) {\n\t      if (list[i] === listener ||\n\t          (list[i].listener && list[i].listener === listener)) {\n\t        position = i;\n\t        break;\n\t      }\n\t    }\n\n\t    if (position < 0)\n\t      return this;\n\n\t    if (list.length === 1) {\n\t      list.length = 0;\n\t      delete this._events[type];\n\t    } else {\n\t      list.splice(position, 1);\n\t    }\n\n\t    if (this._events.removeListener)\n\t      this.emit('removeListener', type, listener);\n\t  }\n\n\t  return this;\n\t};\n\n\tEventEmitter.prototype.removeAllListeners = function(type) {\n\t  var key, listeners;\n\n\t  if (!this._events)\n\t    return this;\n\n\t  // not listening for removeListener, no need to emit\n\t  if (!this._events.removeListener) {\n\t    if (arguments.length === 0)\n\t      this._events = {};\n\t    else if (this._events[type])\n\t      delete this._events[type];\n\t    return this;\n\t  }\n\n\t  // emit removeListener for all listeners on all events\n\t  if (arguments.length === 0) {\n\t    for (key in this._events) {\n\t      if (key === 'removeListener') continue;\n\t      this.removeAllListeners(key);\n\t    }\n\t    this.removeAllListeners('removeListener');\n\t    this._events = {};\n\t    return this;\n\t  }\n\n\t  listeners = this._events[type];\n\n\t  if (isFunction(listeners)) {\n\t    this.removeListener(type, listeners);\n\t  } else if (listeners) {\n\t    // LIFO order\n\t    while (listeners.length)\n\t      this.removeListener(type, listeners[listeners.length - 1]);\n\t  }\n\t  delete this._events[type];\n\n\t  return this;\n\t};\n\n\tEventEmitter.prototype.listeners = function(type) {\n\t  var ret;\n\t  if (!this._events || !this._events[type])\n\t    ret = [];\n\t  else if (isFunction(this._events[type]))\n\t    ret = [this._events[type]];\n\t  else\n\t    ret = this._events[type].slice();\n\t  return ret;\n\t};\n\n\tEventEmitter.prototype.listenerCount = function(type) {\n\t  if (this._events) {\n\t    var evlistener = this._events[type];\n\n\t    if (isFunction(evlistener))\n\t      return 1;\n\t    else if (evlistener)\n\t      return evlistener.length;\n\t  }\n\t  return 0;\n\t};\n\n\tEventEmitter.listenerCount = function(emitter, type) {\n\t  return emitter.listenerCount(type);\n\t};\n\n\tfunction isFunction(arg) {\n\t  return typeof arg === 'function';\n\t}\n\n\tfunction isNumber(arg) {\n\t  return typeof arg === 'number';\n\t}\n\n\tfunction isObject(arg) {\n\t  return typeof arg === 'object' && arg !== null;\n\t}\n\n\tfunction isUndefined(arg) {\n\t  return arg === void 0;\n\t}\n\n\n/***/ })\n/******/ ])\n});\n;","import parseAPNG from 'apng-js';\nimport { DOMAdapter, SCALE_MODE, Sprite, Texture, Ticker, UPDATE_PRIORITY } from 'pixi.js';\n\n/** Represents a single frame of an APNG. Includes image and timing data. */\ninterface FrameObject\n{\n    /** Image data for the current frame */\n    imageData: ImageData;\n    /** The start of the current frame, in milliseconds */\n    start: number;\n    /** The end of the current frame, in milliseconds */\n    end: number;\n}\n\n/** Default options for all AnimatedAPNG objects. */\ninterface AnimatedAPNGOptions\n{\n    /** Whether to start playing right away */\n    autoPlay: boolean;\n    /**\n     * Scale Mode to use for the texture\n     * @type {PIXI.SCALE_MODE}\n     */\n    scaleMode: SCALE_MODE;\n    /** To enable looping */\n    loop: boolean;\n    /** Speed of the animation */\n    animationSpeed: number;\n    /** Set to `false` to manage updates yourself */\n    autoUpdate: boolean;\n    /** The completed callback, optional */\n    onComplete: null | (() => void);\n    /** The loop callback, optional */\n    onLoop: null | (() => void);\n    /** The frame callback, optional */\n    onFrameChange: null | ((currentFrame: number) => void);\n    /** Fallback FPS if APNG contains no time information */\n    fps?: number;\n}\n\n/** Options for the AnimatedAPNG constructor. */\ninterface AnimatedAPNGSize\n{\n    /** Width of the APNG image */\n    width: number;\n    /** Height of the APNG image */\n    height: number;\n}\n\n/**\n * Runtime object to play animated APNGs. This object is similar to an AnimatedSprite.\n * It support playback (seek, play, stop) as well as animation speed and looping.\n * @see Thanks to {@link https://github.com/davidmz/apng-js apng-js}\n */\nclass AnimatedAPNG extends Sprite\n{\n    /**\n     * Default options for all AnimatedAPNG objects.\n     * @property {PIXI.SCALE_MODE} [scaleMode='linear'] - Scale mode to use for the texture.\n     * @property {boolean} [loop=true] - To enable looping.\n     * @property {number} [animationSpeed=1] - Speed of the animation.\n     * @property {boolean} [autoUpdate=true] - Set to `false` to manage updates yourself.\n     * @property {boolean} [autoPlay=true] - To start playing right away.\n     * @property {Function} [onComplete=null] - The completed callback, optional.\n     * @property {Function} [onLoop=null] - The loop callback, optional.\n     * @property {Function} [onFrameChange=null] - The frame callback, optional.\n     * @property {number} [fps=30] - Fallback FPS if APNG contains no time information.\n     */\n    public static defaultOptions: AnimatedAPNGOptions = {\n        scaleMode: 'linear',\n        fps: 30,\n        loop: true,\n        animationSpeed: 1,\n        autoPlay: true,\n        autoUpdate: true,\n        onComplete: null,\n        onFrameChange: null,\n        onLoop: null,\n    };\n\n    /**\n     * The speed that the animation will play at. Higher is faster, lower is slower.\n     * @default 1\n     */\n    public animationSpeed = 1;\n\n    /**\n     * Whether or not the animate sprite repeats after playing.\n     * @default true\n     */\n    public loop = true;\n\n    /**\n     * User-assigned function to call when animation finishes playing. This only happens\n     * if loop is set to `false`.\n     *\n     * @example\n     * animation.onComplete = () => {\n     *   // finished!\n     * };\n     */\n    public onComplete?: () => void;\n\n    /**\n     * User-assigned function to call when animation changes which texture is being rendered.\n     *\n     * @example\n     * animation.onFrameChange = () => {\n     *   // updated!\n     * };\n     */\n    public onFrameChange?: (currentFrame: number) => void;\n\n    /**\n     * User-assigned function to call when `loop` is true, and animation is played and\n     * loops around to start again. This only happens if loop is set to `true`.\n     *\n     * @example\n     * animation.onLoop = () => {\n     *   // looped!\n     * };\n     */\n    public onLoop?: () => void;\n\n    /** The total duration of animation in milliseconds. */\n    public readonly duration: number = 0;\n\n    /** Whether to play the animation after constructing. */\n    public readonly autoPlay: boolean = true;\n\n    /** Collection of frame to render. */\n    private _frames: FrameObject[];\n\n    /** Drawing context reference. */\n    private _context: CanvasRenderingContext2D;\n\n    /** Dirty means the image needs to be redrawn. Set to `true` to force redraw. */\n    public dirty = false;\n\n    /** The current frame number (zero-based index). */\n    private _currentFrame = 0;\n\n    /** `true` uses PIXI.Ticker.shared to auto update animation time.*/\n    private _autoUpdate = false;\n\n    /** `true` if the instance is currently connected to PIXI.Ticker.shared to auto update animation time. */\n    private _isConnectedToTicker = false;\n\n    /** If animation is currently playing. */\n    private _playing = false;\n\n    /** Current playback position in milliseconds. */\n    private _currentTime = 0;\n\n    /**\n     * Create an animated APNG animation from an APNG image's ArrayBuffer. The easiest way to get\n     * the buffer is to use Assets.\n     * @example\n     * import { Assets } from 'pixi.js';\n     * import '@olduvai-jp/pixi-apng';\n     *\n     * const apng = await Assets.load('file.apng');\n     * @param buffer - APNG image arraybuffer from Assets.\n     * @param options - Options to use.\n     * @returns\n     */\n    static async fromBuffer(buffer: ArrayBuffer, options?: Partial<AnimatedAPNGOptions>): Promise<AnimatedAPNG>\n    {\n        if (!buffer || buffer.byteLength === 0)\n        {\n            throw new Error('Invalid buffer');\n        }\n\n        const result = parseAPNG(buffer);\n\n        if (result instanceof Error)\n        {\n            throw new Error(`Failed to parse APNG: ${result.message}`);\n        }\n\n        const apng = result;\n\n        await apng.createImages();\n\n        const frames: FrameObject[] = [];\n\n        // Temporary canvas for frame processing\n        const canvas = DOMAdapter.get().createCanvas(apng.width, apng.height) as HTMLCanvasElement;\n        const context = canvas.getContext('2d', {\n            willReadFrequently: true,\n        }) as CanvasRenderingContext2D;\n\n        let time = 0;\n\n        // Some APNGs may have frames with zero delay, so we need to calculate the fallback\n        const { fps } = Object.assign({}, AnimatedAPNG.defaultOptions, options);\n        const defaultDelay = 1000 / (fps as number);\n\n        // Process each frame and store as ImageData\n        let previousImageData: ImageData | null = null;\n\n        for (let i = 0; i < apng.frames.length; i++)\n        {\n            const frame = apng.frames[i];\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            const { delay, width, height, left, top, blendOp, disposeOp } = frame;\n\n            if (disposeOp === 2 && previousImageData)\n            {\n                context.putImageData(previousImageData, 0, 0);\n            }\n            else if (disposeOp === 1)\n            {\n                context.clearRect(left, top, width, height);\n            }\n\n            previousImageData = context.getImageData(0, 0, apng.width, apng.height);\n\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            context.globalCompositeOperation = blendOp === 0 ? 'copy' : 'source-over';\n\n            if (frame.imageElement)\n            {\n                context.drawImage(frame.imageElement, left, top);\n            }\n\n            // Convert delay from seconds to milliseconds, use default if not provided or zero\n            const frameDelay = (delay && delay > 0) ? delay : defaultDelay;\n\n            frames.push({\n                start: time,\n                end: time + frameDelay,\n                imageData: context.getImageData(0, 0, apng.width, apng.height),\n            });\n            time += frameDelay;\n        }\n\n        // clear the canvas\n        canvas.width = canvas.height = 0;\n        const { width, height } = apng;\n\n        return new AnimatedAPNG(frames, { width, height, ...options });\n    }\n\n    /**\n     * @param frames - Data of the GIF image.\n     * @param options - Options for the AnimatedGIF\n     */\n    constructor(frames: FrameObject[], options: Partial<AnimatedAPNGOptions> & AnimatedAPNGSize)\n    {\n        super(Texture.EMPTY);\n\n        // Handle rerenders\n        this.onRender = () => this.updateFrame();\n\n        // Get the options, apply defaults\n        const { scaleMode, width, height, ...rest } = Object.assign({},\n            AnimatedAPNG.defaultOptions,\n            options\n        );\n\n        // Create the texture\n        const canvas = DOMAdapter.get().createCanvas(width, height) as HTMLCanvasElement;\n        const context = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n        this.texture = Texture.from(canvas);\n        this.texture.source.scaleMode = scaleMode;\n\n        this.duration = (frames[frames.length - 1] as FrameObject).end;\n        this._frames = frames;\n        this._context = context;\n        this._playing = false;\n        this._currentTime = 0;\n        this._isConnectedToTicker = false;\n        Object.assign(this, rest);\n\n        // Draw the first frame\n        this.currentFrame = 0;\n        if (rest.autoPlay)\n        {\n            this.play();\n        }\n    }\n\n    /** Stops the animation. */\n    public stop(): void\n    {\n        if (!this._playing)\n        {\n            return;\n        }\n\n        this._playing = false;\n        if (this._autoUpdate && this._isConnectedToTicker)\n        {\n            Ticker.shared.remove(this.update, this);\n            this._isConnectedToTicker = false;\n        }\n    }\n\n    /** Plays the animation. */\n    public play(): void\n    {\n        if (this._playing)\n        {\n            return;\n        }\n\n        this._playing = true;\n        if (this._autoUpdate && !this._isConnectedToTicker)\n        {\n            Ticker.shared.add(this.update, this, UPDATE_PRIORITY.HIGH);\n            this._isConnectedToTicker = true;\n        }\n\n        // If were on the last frame and stopped, play should resume from beginning\n        if (!this.loop && this.currentFrame === this._frames.length - 1)\n        {\n            this._currentTime = 0;\n        }\n    }\n\n    /**\n     * Get the current progress of the animation from 0 to 1.\n     * @readonly\n     */\n    public get progress(): number\n    {\n        return this._currentTime / this.duration;\n    }\n\n    /** `true` if the current animation is playing */\n    public get playing(): boolean\n    {\n        return this._playing;\n    }\n\n    /**\n     * Updates the object transform for rendering. You only need to call this\n     * if the `autoUpdate` property is set to `false`.\n     *\n     */\n    update(): void\n    {\n        if (!this._playing)\n        {\n            return;\n        }\n\n        const elapsed = this.animationSpeed * Ticker.shared.deltaMS;\n        const currentTime = this._currentTime + elapsed;\n        const localTime = currentTime % this.duration;\n\n        const localFrame = this._frames.findIndex((frame) =>\n            frame.start <= localTime && frame.end > localTime);\n\n        if (currentTime >= this.duration)\n        {\n            if (this.loop)\n            {\n                this._currentTime = localTime;\n                this.updateFrameIndex(localFrame);\n                this.onLoop?.();\n            }\n            else\n            {\n                this._currentTime = this.duration;\n                this.updateFrameIndex(this._frames.length - 1);\n                this.onComplete?.();\n                this.stop();\n            }\n        }\n        else\n        {\n            this._currentTime = localTime;\n            this.updateFrameIndex(localFrame);\n        }\n    }\n\n    /**\n     * Redraw the current frame, is necessary for the animation to work when\n     */\n    private updateFrame(): void\n    {\n        if (!this.dirty)\n        {\n            return;\n        }\n\n        // Update the current frame\n        const { imageData } = this._frames[this._currentFrame] as FrameObject;\n\n        this._context.putImageData(imageData, 0, 0);\n\n        // Workaround hack for Safari & iOS\n        // which fails to upload canvas after putImageData\n        // See: https://bugs.webkit.org/show_bug.cgi?id=229986\n        this._context.fillStyle = 'transparent';\n        this._context.fillRect(0, 0, 0, 1);\n        this.texture.source.update();\n\n        // Mark as clean\n        this.dirty = false;\n    }\n\n    /**\n     * Whether to use PIXI.Ticker.shared to auto update animation time.\n     * @default true\n     */\n    get autoUpdate(): boolean\n    {\n        return this._autoUpdate;\n    }\n\n    set autoUpdate(value: boolean)\n    {\n        if (value !== this._autoUpdate)\n        {\n            this._autoUpdate = value;\n\n            if (!this._autoUpdate && this._isConnectedToTicker)\n            {\n                Ticker.shared.remove(this.update, this);\n                this._isConnectedToTicker = false;\n            }\n            else if (this._autoUpdate && !this._isConnectedToTicker && this._playing)\n            {\n                Ticker.shared.add(this.update, this);\n                this._isConnectedToTicker = true;\n            }\n        }\n    }\n\n    /** Set the current frame number */\n    get currentFrame(): number\n    {\n        return this._currentFrame;\n    }\n    set currentFrame(value: number)\n    {\n        this.updateFrameIndex(value);\n        this._currentTime = (this._frames[value] as FrameObject).start;\n    }\n\n    /** Internally handle updating the frame index */\n    private updateFrameIndex(value: number): void\n    {\n        if (value < 0 || value >= this._frames.length)\n        {\n            throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${value}`);\n        }\n        if (this._currentFrame !== value)\n        {\n            this._currentFrame = value;\n            this.dirty = true;\n            this.onFrameChange?.(value);\n        }\n    }\n\n    /**\n     * Get the total number of frame in the GIF.\n     */\n    get totalFrames(): number\n    {\n        return this._frames.length;\n    }\n\n    /** Destroy and don't use after this. */\n    destroy(): void\n    {\n        this.stop();\n        super.destroy(true);\n\n        const forceClear = null as any;\n\n        this._context = forceClear;\n        this._frames = forceClear;\n        this.onComplete = forceClear;\n        this.onFrameChange = forceClear;\n        this.onLoop = forceClear;\n    }\n\n    /**\n     * Cloning the animation is a useful way to create a duplicate animation.\n     * This maintains all the properties of the original animation but allows\n     * you to control playback independent of the original animation.\n     * If you want to create a simple copy, and not control independently,\n     * then you can simply create a new Sprite, e.g. `const sprite = new Sprite(animation.texture)`.\n     *\n     * The clone will be flagged as `dirty` to immediatly trigger an update\n     */\n    clone(): AnimatedAPNG\n    {\n        const clone = new AnimatedAPNG([...this._frames], {\n            autoUpdate: this._autoUpdate,\n            loop: this.loop,\n            autoPlay: this.autoPlay,\n            scaleMode: this.texture.source.scaleMode,\n            animationSpeed: this.animationSpeed,\n            width: this._context.canvas.width,\n            height: this._context.canvas.height,\n            onComplete: this.onComplete,\n            onFrameChange: this.onFrameChange,\n            onLoop: this.onLoop,\n        });\n\n        clone.dirty = true;\n\n        return clone;\n    }\n}\n\nexport { AnimatedAPNG };\nexport type { AnimatedAPNGOptions };","import { DOMAdapter, extensions, ExtensionType, path } from 'pixi.js';\nimport { AnimatedAPNG, AnimatedAPNGOptions } from './AnimatedAPNG';\n\nimport type { AssetExtension } from 'pixi.js';\n\n/**\n * Handle the loading of APNG images. Registering this loader plugin will\n * load all `.apng` images as an ArrayBuffer and transform into an\n * AnimatedAPNG object.\n * @ignore\n */\nconst APNGAsset = {\n    extension: ExtensionType.Asset,\n    detection: {\n        test: async () => true,\n        add: async (formats) => [...formats, 'apng'],\n        remove: async (formats) => formats.filter((format) => format !== 'apng'),\n    },\n    loader: {\n        name: 'apngLoader',\n        test: (url) => path.extname(url) === '.apng',\n        load: async (url, asset) =>\n        {\n            const response = await DOMAdapter.get().fetch(url);\n            const buffer = await response.arrayBuffer();\n\n            return AnimatedAPNG.fromBuffer(buffer, asset?.data);\n        },\n        unload: async (asset) =>\n        {\n            asset.destroy();\n        },\n    }\n} as AssetExtension<AnimatedAPNG, AnimatedAPNGOptions>;\n\nextensions.add(APNGAsset);\n\nexport { APNGAsset };"],"names":["root","factory","module","this","modules","installedModules","__webpack_require__","moduleId","exports","isNotPNG","isNotAPNG","parseAPNG","_crc","_crc2","_interopRequireDefault","_structs","obj","errNotPNG","errNotAPNG","err","PNGSignature","buffer","bytes","b","i","isAnimated","eachChunk","type","preDataParts","postDataParts","headerDataBytes","frame","frameNumber","apng","off","length","dv","delayN","delayD","subBuffer","preBlob","postBlob","bb","makeDWordArray","makeChunkBytes","p","callback","res","readString","chars","makeStringArray","x","start","a","dataBytes","crcLen","crc","_i","l","table","c","k","_createClass","defineProperties","target","props","descriptor","Constructor","protoProps","staticProps","_player","_player2","_classCallCheck","instance","APNG","f","context","_this","autoPlay","Frame","_this2","resolve","reject","url","_events","_events2","_possibleConstructorReturn","self","call","_inherits","subClass","superClass","_class","_EventEmitter","nextRenderTime","tick","now","EventEmitter","n","isNumber","er","handler","len","args","listeners","isObject","isUndefined","isFunction","listener","m","fired","g","list","position","key","ret","evlistener","emitter","arg","_AnimatedAPNG","Sprite","frames","options","Texture","_a","scaleMode","width","height","rest","__objRest","canvas","DOMAdapter","result","time","fps","defaultDelay","previousImageData","delay","left","top","blendOp","disposeOp","frameDelay","__spreadValues","Ticker","UPDATE_PRIORITY","_b","elapsed","currentTime","localTime","localFrame","imageData","value","forceClear","clone","AnimatedAPNG","APNGAsset","ExtensionType","formats","format","path","asset","extensions"],"mappings":"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"}